<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸŒŒ åŠ«é­‚å·¥ä½œå®¤ï½œæ˜Ÿç©ºå…¥å£</title>
  <style>
    :root{
      --bg:#070914; --bg2:#0b1022; --panel:#0e1630; --text:#e6f2ff; --muted:#9fb3c8;
      --accent:#00ffe7; --accent-soft:rgba(0,255,231,.18);
      --card:#121a39; --shadow:0 10px 30px rgba(0,0,0,.45); --radius:16px;
      --danger:#ffb3c1;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0;}
    body{
      display:flex; flex-direction:column; min-height:100vh;
      color:var(--text); font-family:"Noto Sans TC", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:radial-gradient(circle at 50% 30%, #1a2456 0%, #0a0f24 60%, #060814 100%);
    }
    header{ position:sticky; top:0; background:rgba(10,15,30,.7); backdrop-filter:blur(10px); z-index:10; }
    .nav{ max-width:1100px; margin:0 auto; display:flex; align-items:center; gap:16px; padding:12px 16px }
    .brand{ font-weight:800; letter-spacing:.5px }
    .nav a{ color:var(--text); text-decoration:none; padding:10px 12px; border-radius:12px }
    .nav a.active, .nav a:hover{ background:rgba(0,255,231,.08); box-shadow:0 0 18px var(--accent-soft) }
    .spacer{ flex:1 }
    .btn{ appearance:none; border:0; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700; background:linear-gradient(135deg, #67e8f9, #a7f3d0); color:#031018; font-size:14px }
    .btn.secondary{ background:rgba(255,255,255,.06); color:var(--text); border:1px solid rgba(255,255,255,.12) }
    .btn.delete{ background:#e74c3c; color:#fff }
    .btn.reset{ background:#f39c12; color:#fff }
    .btn.outline{ background:transparent; border:1px solid rgba(255,255,255,.25); color:var(--text) }
    main{ flex:1; max-width:1100px; margin:40px auto; padding:0 16px }
    section{ margin-bottom:24px }
    .panel{ background:var(--card); border-radius:var(--radius); padding:20px; box-shadow:var(--shadow); margin-bottom:20px }
    h1,h2{ margin-top:0 }
    .muted{ color:var(--muted) }
    .danger{ color:var(--danger) }
    .grid{ display:grid; gap:16px }
    .grid.auto{ grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }

    .card{
      background:var(--panel); border-radius:12px; padding:26px; box-shadow:var(--shadow);
      opacity:0; transform:translateY(40px); transition:all .8s ease;
    }
    .card.show{ opacity:1; transform:translateY(0); }

    footer{ text-align:center; padding:20px; color:var(--muted); margin-top:auto }
    .field{ display:grid; gap:6px; margin-bottom:14px }
    label{ font-size:15px; color:var(--muted) }
    input, textarea, select{
      width:100%; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      color:var(--text); border-radius:12px; padding:12px; outline:none; font-size:15px
    }
    textarea{ min-height:120px; resize:vertical }
    .userpill{ display:flex; align-items:center; gap:10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); padding:6px 10px; border-radius:20px }
    .welcome{ font-size:24px; font-weight:700; color:#7fffd4; margin:18px 0; text-align:center; }
    table{ width:100%; border-collapse:collapse; margin-top:10px }
    th,td{ border:1px solid rgba(255,255,255,.15); padding:8px; font-size:14px; text-align:left }
    th{ background:rgba(255,255,255,.08); }
    img.avatar{ width:26px; height:26px; border-radius:50%; vertical-align:middle; object-fit:cover }
    .contract-box{ background:rgba(255,255,255,.05); border:1px dashed rgba(255,255,255,.2); padding:14px; border-radius:12px; white-space:pre-wrap; line-height:1.6 }
    .inline{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .status-badge{ padding:2px 8px; border-radius:999px; background:rgba(255,255,255,.1); font-size:12px }
  </style>
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <header>
    <nav class="nav" id="navBar">
      <div class="brand">åŠ«é­‚å·¥ä½œå®¤</div>
      <a href="#home" data-nav="home">ğŸ  ä¸»é </a>
      <a href="#services" data-nav="services">ğŸ› ï¸ å·¥ä½œå®¤æœå‹™</a>
      <a href="#order" data-nav="order">ğŸ“ è¨‚å–®/æ¡ˆä»¶</a>
      <div class="spacer"></div>
      <div id="authArea"></div>
    </nav>
  </header>

  <main>
    <section id="home">
      <div class="panel">
        <h1>ğŸŒŒ æ­¡è¿ä¾†åˆ°åŠ«é­‚å·¥ä½œå®¤</h1>
        <p class="muted">æˆ‘å€‘è‡´åŠ›æ–¼éŠæˆ²é–‹ç™¼ã€ç¶²é è¨­è¨ˆã€Discord æ©Ÿå™¨äººã€TRPG èˆ‡å½±éŸ³å‰µä½œï¼Œæ‰“é€ å¤šå…ƒçš„äº’å‹•é«”é©—ã€‚</p>
        <div id="welcomeMsg"></div>
      </div>
      <div class="grid auto">
        <div class="card">
          <h2>ğŸ¢ å·¥ä½œå®¤ä»‹ç´¹</h2>
          <p class="muted">å°ˆæ³¨æ–¼éŠæˆ²ã€äº’å‹•ç¶²ç«™èˆ‡å°ˆæ¡ˆæ•´åˆï¼Œçµåˆå‰µæ„èˆ‡å·¥ç¨‹è½åœ°ã€‚</p>
        </div>
        <div class="card">
          <h2>ğŸ› ï¸ æˆ‘å€‘èƒ½å¹«ä½ </h2>
          <p class="muted">ç¶²ç«™å»ºç½®ã€éŠæˆ²ç³»çµ±ã€Discord Botã€è³‡æ–™è™•ç†ã€è‡ªå‹•åŒ–æµç¨‹ã€‚</p>
        </div>
        <div class="card">
          <h2>ğŸ“¢ è¿‘æœŸå‹•æ…‹</h2>
          <p class="muted">Godot éŠæˆ²ã€å‰ç«¯ç¶²ç«™ã€ç¤¾ç¾¤æ©Ÿå™¨äººèˆ‡ TRPG æ•…äº‹æ¨¡çµ„ã€‚</p>
        </div>
      </div>
    </section>
    <section id="services" style="display:none">
      <div class="panel">
        <h1>ğŸŒŸ å°ˆæ¥­æœå‹™é …ç›® ğŸŒŸ</h1>
        <p class="muted">ğŸ® Minecraft | ğŸ² TRPG | ğŸ¤– Discord | ğŸŒ Web | ğŸ¬ å½±éŸ³</p>
        <p class="muted">å¾ <strong>å…§å®¹ç­–åŠƒã€ç³»çµ±è¨­è¨ˆã€é–‹ç™¼åˆ°ä¸Šç·š</strong>ï¼Œä¸€ç«™å¼å¹«ä½ æå®šã€‚</p>
      </div>

      <div class="grid auto">
        <div class="card">
          <h2>ğŸ§± Minecraft æœå‹™</h2>
          <ul class="muted">
            <li>âœ¨ å°ˆå±¬å»ºç¯‰è¨­è¨ˆã€é¢¨æ ¼çµ±ä¸€</li>
            <li>ğŸ”§ æ¨¡çµ„å®‰è£ / é…ç½® / é™¤éŒ¯</li>
            <li>ğŸ¥ Replay Mod é«˜è³ªæ„Ÿå‰ªè¼¯</li>
          </ul>
        </div>
        <div class="card">
          <h2>ğŸ² TRPG æœå‹™</h2>
          <ul class="muted">
            <li>ğŸŒ ä¸–ç•Œè§€æ¶æ§‹èˆ‡æ¨¡çµ„åŒ–ç´ æ</li>
            <li>ğŸ©¹ è¦å‰‡ / åŠ‡æƒ…æ¼æ´ä¿®è£œ</li>
            <li>ğŸ“‘ è§’è‰²è³‡æ–™èˆ‡æµç¨‹ç®¡ç†</li>
            <li>âš¡ æ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹æ•™å­¸</li>
          </ul>
        </div>
        <div class="card">
          <h2>ğŸ’» å…¶ä»–å‰µä½œæœå‹™</h2>
          <ul class="muted">
            <li>ğŸ¬ å½±ç‰‡å‰ªè¼¯ï¼šå¯¦æ³ã€å®£å‚³ç‰‡ã€Vlog</li>
            <li>ğŸŒ ç¶²ç«™è£½ä½œï¼šå‰å¾Œç«¯æ•´åˆ</li>
            <li>ğŸ® éŠæˆ²ç³»çµ±è¨­è¨ˆèˆ‡æŠ€è¡“æ”¯æ´</li>
          </ul>
        </div>
        <div class="card">
          <h2>ğŸ’ Nitro ä»£è³¼</h2>
          <ul class="muted">
            <li>âœ… åˆæ³•æˆæ¬Šã€å®‰å…¨ä»£è³¼</li>
            <li>ğŸ’² ä¾¿å®œæ”¯ä»˜</li>
            <li>âš¡ å¿«é€Ÿå›è¦†ã€å³æ™‚äº¤ä»˜</li>
          </ul>
        </div>
        <div class="card">
          <h2>ğŸ¤– å·¥ä½œå®¤æ©Ÿå™¨äºº</h2>
          <ul class="muted">
            <li>ğŸ¯ è±å¯Œä½ çš„ä¼ºæœå™¨åŠŸèƒ½</li>
            <li>ğŸ¤ æ–¹ä¾¿åŠ å…¥ã€å¿«é€Ÿéƒ¨ç½²</li>
            <li>ğŸ’² åƒ¹æ ¼å¯¦æƒ </li>
          </ul>
        </div>
        <div class="card">
          <h2>ğŸ§§ ç‰¹æ®Šä»£è³¼</h2>
          <ul class="muted">
            <li>1. Roblox å¹£è³¼è²·</li>
            <li>2. è¦çš®ä»£è³¼</li>
            <li>3. è²æ®¼å¹£ä»£è³¼</li>
            <li>4. MyCard åºè™Ÿ</li>
            <li>5. æŠ–éŸ³å¹£</li>
            <li>6. å¿«æ‰‹å„²å€¼</li>
            <li>7. Roblox è¨‚é–±</li>
            <li>8. å…¶ä»–è·¨å¢ƒä»£è³¼</li>
          </ul>
          <p class="muted" style="margin-top:8px">è©³è«‡ Discordï¼Œä¸¦æ”¯æŒç‰©æµè²¨é‹ã€‚</p>
        </div>
      </div>

      <div class="panel" style="margin-top:20px">
        <p class="muted">ğŸ’¡ ä¸è«–æ˜¯ Minecraftã€TRPGï¼Œé‚„æ˜¯ç¶²ç«™èˆ‡æ©Ÿå™¨äººï¼Œæˆ‘å€‘éƒ½èƒ½æˆç‚ºä½ çš„æœ€ä½³å¹«æ‰‹ï¼</p>
        <p class="muted">ğŸ“© æ­¡è¿è¯ç¹«åˆä½œï¼Œä¸€èµ·å¯¦ç¾ä½ çš„å‰µæ„ ğŸ‰</p>
        <p class="muted danger">ï¼åƒ¹æ ¼å¯¦æƒ ï¼Œæ­¡è¿æ´½è«‡ï¼</p>
      </div>
    </section>
    <section id="order" style="display:none">
      <div class="panel">
        <h1>ğŸ“ è¨‚å–® / æ¡ˆä»¶æ´½è©¢</h1>
        <p class="muted">å¡«å¯«ä¸‹æ–¹è¡¨å–®ï¼Œæäº¤å¾Œæœƒé€äº¤ç®¡ç†å“¡å¯©æ ¸ï¼ˆå¯é¸æ“‡åŒæ­¥é€šçŸ¥ Discord æˆ– Emailï¼‰ã€‚</p>
      </div>

      <div class="grid auto">
        <div class="card">
          <h2>ğŸ“® æäº¤è¡¨å–®</h2>
          <form onsubmit="submitOrder(event)">
            <div class="field">
              <label>ä½ çš„å§“åï¼ˆæˆ–æš±ç¨±ï¼‰</label>
              <input id="orderName" placeholder="ä¾‹ï¼šå°æ˜" required>
            </div>
            <div class="field">
              <label>Email</label>
              <input id="orderEmail" type="email" placeholder="you@example.com" required>
            </div>
            <div class="field">
              <label>æ¡ˆä»¶é¡å‹</label>
              <select id="orderType" required>
                <option value="">è«‹é¸æ“‡</option>
                <option>ç¶²ç«™è£½ä½œ</option>
                <option>Discord æ©Ÿå™¨äºº</option>
                <option>Minecraft æœå‹™</option>
                <option>TRPG æœå‹™</option>
                <option>å½±ç‰‡å‰ªè¼¯</option>
                <option>å…¶ä»–</option>
              </select>
            </div>
            <div class="field">
              <label>éœ€æ±‚æè¿°</label>
              <textarea id="orderDesc" placeholder="è«‹æè¿°ä½ çš„éœ€æ±‚ã€é ç®—æˆ–ç›®æ¨™...ï¼ˆå¯è²¼ä¸Šé€£çµï¼‰" required></textarea>
            </div>

            <h3>ğŸ“œ ä»˜æ¬¾åˆç´„</h3>
            <div id="contractBox" class="contract-box"></div>

            <div class="field inline">
              <input id="agreeCheck" type="checkbox" required>
              <label for="agreeCheck">æˆ‘å·²é–±è®€ä¸¦éµå®ˆä»˜æ¬¾åˆç´„</label>
            </div>
            <div class="field">
              <label>è«‹è¼¸å…¥ã€Œæˆ‘åŒæ„ã€ä»¥ç¢ºèª</label>
              <input id="agreeText" placeholder="æˆ‘åŒæ„" required>
            </div>
            <div class="field">
              <label>çœŸå¯¦å§“åï¼ˆå¿…è¦ï¼‰</label>
              <input id="realName" placeholder="è«‹è¼¸å…¥ä½ çš„çœŸå¯¦å§“å" required>
            </div>

            <button class="btn" type="submit">æäº¤è¨‚å–®</button>
          </form>
        </div>

        <div class="card">
          <h2>â„¹ï¸ æé†’</h2>
          <ul class="muted">
            <li>æäº¤å¾Œé€²å…¥ã€Œå¾…å¯©æ ¸ã€ç‹€æ…‹ï¼Œç®¡ç†å“¡ç¢ºèªå¾Œæœƒæ›´æ”¹ç‹€æ…‹ã€‚</li>
            <li>è‹¥ç®¡ç†å“¡è¨­å®šäº† Discord Webhook æˆ– Emailï¼Œæœƒå³æ™‚é€šçŸ¥ã€‚</li>
            <li>è«‹å‹™å¿…è¼¸å…¥çœŸå¯¦å§“åã€å‹¾é¸åŒæ„ä¸¦è¼¸å…¥ã€Œæˆ‘åŒæ„ã€ï¼Œå¦å‰‡ç„¡æ³•é€å‡ºã€‚</li>
          </ul>
        </div>
      </div>
    </section>
    <section id="admin" style="display:none">
      <div class="panel">
        <h1>ğŸ›¡ï¸ ç®¡ç†å“¡å¾Œå°</h1>

        <div class="grid auto">
          <div class="card">
            <h2>ğŸ‘¥ ä½¿ç”¨è€…æ¸…å–®</h2>
            <div class="inline" style="gap:8px;margin:8px 0">
              <button class="btn" onclick="exportUsers()">ğŸ“¤ åŒ¯å‡º JSON</button>
              <input type="file" id="importFile" style="display:none" accept="application/json" onchange="importUsers(event)">
              <button class="btn secondary" onclick="document.getElementById('importFile').click()">ğŸ“¥ ç´å…¥ JSON</button>
            </div>
            <table id="userTable">
              <thead>
                <tr><th>æš±ç¨±</th><th>å¸³è™Ÿ/Email</th><th>è¨»å†Šæ™‚é–“</th><th>æ˜¯å¦ç®¡ç†å“¡</th><th>æ“ä½œ</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="card">
            <h2>ğŸ“£ é€šçŸ¥è¨­å®š</h2>
            <div class="field">
              <label>Discord Webhook URLï¼ˆé¸å¡«ï¼‰</label>
              <input id="setWebhook" placeholder="https://discord.com/api/webhooks/...">
            </div>
            <div class="field">
              <label>é€šçŸ¥ Emailï¼ˆé¸å¡«ï¼‰</label>
              <input id="setEmail" type="email" placeholder="your-notify@example.com">
            </div>
            <div class="inline">
              <button class="btn" onclick="saveSettings()">ğŸ’¾ å„²å­˜è¨­å®š</button>
              <span class="muted">ï¼ˆä¿å­˜åœ¨æœ¬æ©Ÿï¼‰</span>
            </div>
            <p class="muted" style="margin-top:10px">âš ï¸ å‰ç«¯å¡«å…¥ Webhook ä»å±¬å…¬é–‹ç’°å¢ƒï¼Œå»ºè­°åƒ…åœ¨å…§éƒ¨æˆ–æ¸¬è©¦ä½¿ç”¨ï¼›æ­£å¼ä¸Šç·šè«‹æ”¹ç‚ºå¾Œç«¯è½‰ç™¼ã€‚</p>
          </div>
        </div>

        <div class="card" style="margin-top:16px">
          <h2>ğŸ—‚ï¸ è¨‚å–®å¯©æ ¸</h2>
          <table id="orderTable">
            <thead>
              <tr>
                <th>ID</th><th>å®¢æˆ¶</th><th>Email</th><th>é¡å‹</th><th>å»ºç«‹æ™‚é–“</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
    <section id="auth" style="display:none">
      <div class="grid auto">
        <div class="card">
          <h2 style="font-size:26px">ğŸ”’ ç™»å…¥</h2>
          <form onsubmit="login(event)">
            <div class="field">
              <label for="loginEmail">å¸³è™Ÿ / Email</label>
              <input id="loginEmail" type="text" required placeholder="you@example.com æˆ– jason">
            </div>
            <div class="field">
              <label for="loginPassword">å¯†ç¢¼</label>
              <input id="loginPassword" type="password" required>
            </div>
            <button class="btn" type="submit">ç™»å…¥</button>
          </form>

          <hr style="margin:20px 0; border:1px solid rgba(255,255,255,.1)">

          <div id="g_id_onload"
               data-client_id="77113728575-ca1s75fj6ocok3vhs7toph3dafc2l5v4.apps.googleusercontent.com"
               data-context="signin"
               data-ux_mode="popup"
               data-callback="handleGoogleResponse"
               data-auto_select="true"
               data-itp_support="true"></div>
          <div class="g_id_signin"
               data-type="standard"
               data-shape="rectangular"
               data-theme="outline"
               data-text="signin_with"
               data-size="large"
               data-logo_alignment="left"></div>
        </div>

        <div class="card">
          <h2 style="font-size:26px">ğŸ†• è¨»å†Š</h2>
          <form onsubmit="register(event)">
            <div class="field">
              <label for="regName">é¡¯ç¤ºåç¨±</label>
              <input id="regName" type="text" required maxlength="30" placeholder="ä½ çš„æš±ç¨±">
            </div>
            <div class="field">
              <label for="regEmail">Email</label>
              <input id="regEmail" type="email" required placeholder="you@example.com">
            </div>
            <div class="field">
              <label for="regPassword">å¯†ç¢¼ï¼ˆè‡³å°‘ 6 ç¢¼ï¼‰</label>
              <input id="regPassword" type="password" required minlength="6">
            </div>
            <button class="btn" type="submit">å»ºç«‹å¸³è™Ÿ</button>
          </form>
        </div>
      </div>
    </section>
  </main>

  <footer>Â© <span id="year"></span> åŠ«é­‚å·¥ä½œå®¤ Â· Demo only</footer>

  <script>
    const LS_USERS="studio_users", LS_SESSION="studio_session", LS_ORDERS="studio_orders", LS_SETTINGS="studio_settings";
    const ADMIN_SALT = "studio_salt_v1";
    const ADMIN_USER_HASH = "f3cbb0d01df7cb36ff736885447055c08c4d1cc977c40ad9e7884cd9b38ff2df";
    const ADMIN_PASS_HASH = "e2dded817c73acd2c3558c09480680fb94280cdf2ace74ced1e85e38a72a1049";
    async function sha256Hex(str){
      const enc = new TextEncoder().encode(str);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      const arr = Array.from(new Uint8Array(buf));
      return arr.map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    async function isAdminCredential(inputUser, inputPass){
      const uhash = await sha256Hex(inputUser.toLowerCase() + ADMIN_SALT);
      if(uhash !== ADMIN_USER_HASH) return false;
      const phash = await sha256Hex(inputPass + ADMIN_SALT);
      return phash === ADMIN_PASS_HASH;
    }

    const sections=['home','services','order','auth','admin'];
    function showSection(id){
      if(id==='admin'){
        const u=sessionUser();
        if(!u||!u.isAdmin){ alert("éœ€è¦ç®¡ç†å“¡æ¬Šé™"); id='home'; location.hash="#home"; }
      }
      sections.forEach(s=>{
        const el=document.getElementById(s);
        if(el) el.style.display=(s===id)?'block':'none';
      });
      document.querySelectorAll('.nav a[data-nav]').forEach(a=>a.classList.toggle('active',a.dataset.nav===id));
      if(id==='home'){ renderWelcomeMsg(); }
      if(id==='admin'){ renderUserTable(); renderOrderTable(); loadSettingsToUI(); }
      if(id==='order'){ renderContractPreview(); }
      attachObserverToCards(document.getElementById(id));
    }
    window.addEventListener('hashchange',()=>showSection((location.hash||'#home').slice(1)));
    document.getElementById('year').textContent=new Date().getFullYear();

    function readUsers(){ return JSON.parse(localStorage.getItem(LS_USERS) || "[]"); }
    function writeUsers(list){ localStorage.setItem(LS_USERS, JSON.stringify(list)); }
    function sessionUser(){ try{ return JSON.parse(localStorage.getItem(LS_SESSION)); }catch{return null} }
    function readOrders(){ return JSON.parse(localStorage.getItem(LS_ORDERS) || "[]"); }
    function writeOrders(list){ localStorage.setItem(LS_ORDERS, JSON.stringify(list)); }
    function readSettings(){ return JSON.parse(localStorage.getItem(LS_SETTINGS) || '{"webhook":"","email":""}'); }
    function writeSettings(obj){ localStorage.setItem(LS_SETTINGS, JSON.stringify(obj)); }

    function register(ev){
      ev.preventDefault();
      const name=document.getElementById("regName").value.trim();
      const email=document.getElementById("regEmail").value.trim().toLowerCase();
      const password=document.getElementById("regPassword").value;
      const users=readUsers();
      if(users.some(u=>u.email===email)){ alert("Email å·²è¨»å†Š"); return; }
      users.push({name,email,password,createdAt:new Date().toISOString()});
      writeUsers(users);
      alert("è¨»å†ŠæˆåŠŸï¼Œè«‹ç™»å…¥ï¼");
      location.hash="#auth";
    }

    // è®Šæ›´ç‚º asyncï¼šå› ç‚ºè¦ç­‰ SHA-256
    async function login(ev){
      ev.preventDefault();
      const emailInput=document.getElementById("loginEmail").value.trim();
      const password=document.getElementById("loginPassword").value;

      // 1) å˜—è©¦ç®¡ç†å“¡ï¼ˆé›œæ¹Šæ¯”å°ï¼‰
      if(await isAdminCredential(emailInput, password)){
        const adminUser={ name:"ç®¡ç†å“¡", email:"jason", isAdmin:true };
        localStorage.setItem(LS_SESSION, JSON.stringify(adminUser));
        renderAuthArea(); renderWelcomeMsg();
        alert("ç™»å…¥æˆåŠŸï¼æ­¡è¿ ç®¡ç†å“¡");
        location.hash="#admin"; return;
      }

      // 2) ä¸€èˆ¬ç”¨æˆ¶
      const users=readUsers();
      const email=emailInput.toLowerCase();
      const user=users.find(u=>u.email===email && u.password===password);
      if(!user){ alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤"); return; }
      const session={ name:user.name||email, email:email, isAdmin:false, picture:user.picture||null };
      localStorage.setItem(LS_SESSION, JSON.stringify(session));
      renderAuthArea(); renderWelcomeMsg();
      alert("ç™»å…¥æˆåŠŸï¼æ­¡è¿ "+session.name);
      location.hash="#home";
    }

    function handleGoogleResponse(response){
      try{
        const payload=JSON.parse(atob(response.credential.split('.')[1]));
        const baseUser={ name:payload.name, email:(payload.email||"").toLowerCase(), picture:payload.picture||null, password:null };
        let users=readUsers();
        const idx=users.findIndex(u=>u.email===baseUser.email);
        if(idx===-1){ users.push({...baseUser, createdAt:new Date().toISOString()}); }
        else{
          if(!users[idx].createdAt) users[idx].createdAt=new Date().toISOString();
          if(!users[idx].picture && baseUser.picture) users[idx].picture=baseUser.picture;
        }
        writeUsers(users);
        localStorage.setItem(LS_SESSION, JSON.stringify({...baseUser, isAdmin:false}));
        renderAuthArea(); renderWelcomeMsg();
        alert("Google ç™»å…¥æˆåŠŸï¼š"+baseUser.name);
        location.hash="#home";
      }catch(e){ console.error(e); alert("Google ç™»å…¥è§£æå¤±æ•—"); }
    }

    function logout(){
      localStorage.removeItem(LS_SESSION);
      renderAuthArea(); renderWelcomeMsg();
      alert("å·²ç™»å‡º");
      location.hash="#home";
    }

    function renderAuthArea(){
      const area=document.getElementById('authArea');
      const nav=document.getElementById('navBar');
      const u=sessionUser();
      nav.querySelectorAll("a[data-nav='admin']").forEach(el=>el.remove());
      if(u){
        if(u.isAdmin){
          const adminLink=document.createElement("a");
          adminLink.href="#admin"; adminLink.textContent="ğŸ›¡ï¸ ç®¡ç†å“¡"; adminLink.setAttribute("data-nav","admin");
          nav.insertBefore(adminLink, nav.querySelector(".spacer"));
        }
        const avatar=u.picture?`<img src="${u.picture}" class="avatar" alt="avatar"> `:"";
        area.innerHTML=`<div class="userpill">${avatar}${u.name || u.email}<button class="btn secondary" style="margin-left:8px" onclick="logout()">ç™»å‡º</button></div>`;
      } else {
        area.innerHTML=`<a href="#auth" data-nav="auth" class="btn">ç™»å…¥ / è¨»å†Š</a>`;
      }
    }

    function renderWelcomeMsg(){
      const u=sessionUser();
      const msg=document.getElementById('welcomeMsg');
      if(u){
        const avatar=u.picture?`<img src="${u.picture}" class="avatar" alt="avatar"> `:"";
        msg.innerHTML=`<div class="welcome">ğŸ‘‹ æ­¡è¿å›ä¾†ï¼Œ${avatar}${u.name || u.email}ï¼</div>`;
      } else { msg.innerHTML=""; }
    }

    function buildContractText(name, email){
      const who = name || email || "(å¡«å…¥å®¢æˆ¶åç¨±æˆ–email)";
      return `ä»˜æ¬¾åˆç´„
æœ¬å·¥ä½œå®¤æä¾›éŠ€è¡Œå¸³æˆ¶ï¼Œç”± ${who} é€²è¡Œè½‰å¸³æˆ–åŒ¯æ¬¾æ”¯ä»˜è²»ç”¨ï¼ˆä»¥é›™æ–¹æ›¸é¢æˆ–è¨Šæ¯ç¢ºèªä¹‹é‡‘é¡ç‚ºæº–ï¼‰ï¼Œä¸¦é¡˜æ„éµå®ˆä¸‹é¢åˆç´„å…§å®¹:

1.ä¸æ´©æ¼ä»»ä½•éŠ€è¡Œå¸³æˆ¶çš„è³‡è¨Šï¼Œå¦‚è‹¥æ´©æ¼ï¼Œæœ¬å·¥ä½œå®¤å‰‡å°‡æèµ·è¨´è¨Ÿç¨‹åº

2.ä¸é€šéæœ¬å·¥ä½œå®¤é€²è¡Œä»»ä½•é•æ³•äº‹æƒ…

3.åƒ…ä¾é›™æ–¹ç¢ºèªä¹‹é‡‘é¡ï¼ˆä¸å«æ‰‹çºŒè²»ï¼‰é€²è¡ŒåŒ¯æ¬¾æˆ–è½‰å¸³ï¼›é™¤éå¦è¡Œç°½è¨‚åŠ å€¼åˆç´„ï¼Œå¦å‰‡ä¸å†é€²è¡Œä»»ä½•é¡å¤–åŒ¯æ¬¾æˆ–è½‰å¸³

4.æœ¬å·¥ä½œå®¤ä¸å¾—æ´©æ¼ä»»ä½•çš„å®¢æˆ¶è³‡è¨Š

5.æœ¬å·¥ä½œå®¤å¸³æˆ¶å¦‚è‹¥è¢«ä»–äººåŒ¯æ¬¾æˆ–è½‰æ¬¾ã€ç”šè‡³æ–¼å…¶ä»–éæ³•ç”¨é€”ï¼Œ ${who} å®¢æˆ¶å°‡ç¢ºä¿ä¸æ˜¯è‡ªèº«æ‰€æ´©æ¼å¸³æˆ¶è³‡æ–™ 

å¦‚è‹¥é¡˜æ„ç°½è¨‚åˆç´„ï¼Œè«‹å¹«æˆ‘åœ¨æœ¬è¨Šæ¯å›å¾©âœ… ï¼Œä¸¦è¨Šæ¯å›å¾© {æˆ‘åŒæ„}ï¼Œè€Œæœ¬å·¥ä½œå®¤å°‡é€²è¡Œæˆªåœ–+ä»¥æ©Ÿå™¨äººåŠ å¯†çµ¦äºˆå¸³æˆ¶è¨Šæ¯ï¼Œè«‹æ–¼24å°æ™‚è‡³48å°æ™‚å…§ï¼Œå®Œæˆè½‰å¸³æˆ–åŒ¯æ¬¾ï¼Œå¦‚è‹¥ç„¡ï¼Œä¹Ÿä¸é–‹æ”¾è½‰å¸³æˆ–åŒ¯æ¬¾ï¼Œè«‹å¹«æˆ‘é‡æ–°ç°½è¨‚åˆç´„`;
    }
    function renderContractPreview(){
      const name = (document.getElementById('orderName')||{}).value || "";
      const email= (document.getElementById('orderEmail')||{}).value || "";
      const box=document.getElementById('contractBox');
      if(box) box.textContent = buildContractText(name,email);
    }
    ['orderName','orderEmail'].forEach(id=>{
      document.addEventListener('input',e=>{
        if(e.target && e.target.id===id) renderContractPreview();
      });
    });

    function submitOrder(ev){
      ev.preventDefault();
      const name=document.getElementById('orderName').value.trim();
      const email=document.getElementById('orderEmail').value.trim();
      const type=document.getElementById('orderType').value;
      const desc=document.getElementById('orderDesc').value.trim();
      const agreeCheck=document.getElementById('agreeCheck').checked;
      const agreeText=document.getElementById('agreeText').value.trim();
      const realName=document.getElementById('realName').value.trim();

      if(!agreeCheck){ alert("è«‹å‹¾é¸åŒæ„ä»˜æ¬¾åˆç´„"); return; }
      if(agreeText!=="æˆ‘åŒæ„"){ alert('è«‹åœ¨ç¢ºèªæ¬„è¼¸å…¥ã€Œæˆ‘åŒæ„ã€'); return; }
      if(!realName){ alert("è«‹å¡«å¯«çœŸå¯¦å§“å"); return; }

      const id="O"+Date.now().toString(36)+Math.random().toString(36).slice(2,6);
      const order={
        id,name,email,type,desc,
        contract:buildContractText(name||email,email),
        realName,status:"å¾…å¯©æ ¸",
        createdAt:new Date().toISOString()
      };
      const orders=readOrders();
      orders.unshift(order);
      writeOrders(orders);
      notifyChannels(order);
      alert("å·²æäº¤ï¼è¨‚å–®ç·¨è™Ÿï¼š"+id+"ï¼ˆç‹€æ…‹ï¼šå¾…å¯©æ ¸ï¼‰");
      ev.target.reset();
      renderContractPreview();
    }

    async function notifyChannels(order){
      const set=readSettings();
      if(set.webhook){
        try{
          const content=`ğŸ†• æ–°è¨‚å–® | ${order.id}
å®¢æˆ¶ï¼š${order.name}ï¼ˆ${order.email}ï¼‰
é¡å‹ï¼š${order.type}
ç‹€æ…‹ï¼š${order.status}
æ™‚é–“ï¼š${new Date(order.createdAt).toLocaleString()}
â€”â€”
éœ€æ±‚ï¼š
${order.desc}`;
          await fetch(set.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content})});
        }catch(e){ console.warn("Webhook é€šçŸ¥å¤±æ•—",e); }
      }
      if(set.email){
        const subject=encodeURIComponent(`æ–°è¨‚å–® ${order.id} - ${order.type}`);
        const body=encodeURIComponent(
`æ–°è¨‚å–®
ç·¨è™Ÿï¼š${order.id}
å®¢æˆ¶ï¼š${order.name}ï¼ˆ${order.email}ï¼‰
é¡å‹ï¼š${order.type}
ç‹€æ…‹ï¼š${order.status}
æ™‚é–“ï¼š${new Date(order.createdAt).toLocaleString()}

éœ€æ±‚ï¼š
${order.desc}

åˆç´„ï¼š
${order.contract}
`);
        const link=`mailto:${encodeURIComponent(set.email)}?subject=${subject}&body=${body}`;
        window.open(link,"_blank");
      }
    }

    function saveSettings(){
      const webhook=document.getElementById('setWebhook').value.trim();
      const email=document.getElementById('setEmail').value.trim();
      writeSettings({webhook,email});
      alert("å·²å„²å­˜é€šçŸ¥è¨­å®š");
    }
    function loadSettingsToUI(){
      const s=readSettings();
      document.getElementById('setWebhook').value=s.webhook||"";
      document.getElementById('setEmail').value=s.email||"";
    }

    function renderUserTable(){
      const tbody=document.querySelector("#userTable tbody");
      if(!tbody) return;
      tbody.innerHTML="";
      tbody.innerHTML+=`<tr><td>ç®¡ç†å“¡ Jason</td><td>jason</td><td>-</td><td>âœ…</td><td>ğŸš«</td></tr>`;
      const users=readUsers();
      users.forEach(u=>{
        const name=u.name||"-";
        const email=u.email||"-";
        const time=u.createdAt?new Date(u.createdAt).toLocaleString():"-";
        tbody.innerHTML+=`
          <tr>
            <td>${name}</td>
            <td>${email}</td>
            <td>${time}</td>
            <td>âŒ</td>
            <td>
              <button class="btn" style="background:#3b82f6;color:#fff" onclick="viewUser('${email}')">ğŸ‘ï¸ æª¢è¦–</button>
              <button class="btn reset" onclick="resetPassword('${email}')">âœï¸ é‡è¨­</button>
              <button class="btn delete" onclick="deleteUser('${email}')">ğŸ—‘ï¸ åˆªé™¤</button>
            </td>
          </tr>`;
      });
    }
    function deleteUser(email){
      if(!confirm("ç¢ºå®šè¦åˆªé™¤ä½¿ç”¨è€… "+email+" ?")) return;
      let users=readUsers();
      users=users.filter(u=>u.email!==email);
      writeUsers(users);
      renderUserTable();
    }
    function resetPassword(email){
      const newPass=prompt("è«‹è¼¸å…¥æ–°å¯†ç¢¼ï¼š",""); if(newPass===null) return;
      if(newPass.trim()===""){ alert("å¯†ç¢¼ä¸å¯ç‚ºç©º"); return; }
      let users=readUsers(), changed=false;
      users=users.map(u=>{ if(u.email===email){ u.password=newPass; changed=true; } return u; });
      if(!changed){ alert("æ‰¾ä¸åˆ°è©²ä½¿ç”¨è€…"); return; }
      writeUsers(users); alert("å·²æˆåŠŸé‡è¨­ "+email+" çš„å¯†ç¢¼ï¼"); renderUserTable();
    }
    function viewUser(email){
      const u=readUsers().find(x=>x.email===email);
      if(!u){ alert("æ‰¾ä¸åˆ°ä½¿ç”¨è€…"); return; }
      alert(`æš±ç¨±ï¼š${u.name||"-"}\nEmailï¼š${u.email}\nå¯†ç¢¼ï¼š${u.password??"(Google ç™»å…¥/æœªè¨­å®š)"}\nè¨»å†Šæ™‚é–“ï¼š${u.createdAt?new Date(u.createdAt).toLocaleString():"-"}`);
    }
    function exportUsers(){
      const data=JSON.stringify(readUsers(),null,2);
      const blob=new Blob([data],{type:"application/json"});
      const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="users.json"; a.click();
      URL.revokeObjectURL(a.href);
    }
    function importUsers(ev){
      const file=ev.target.files[0]; if(!file) return;
      const r=new FileReader();
      r.onload=e=>{ try{
          const arr=JSON.parse(e.target.result);
          if(!Array.isArray(arr)) throw new Error("æ ¼å¼éœ€ç‚ºé™£åˆ—");
          writeUsers(arr); renderUserTable(); alert("åŒ¯å…¥æˆåŠŸ");
        }catch(err){ console.error(err); alert("åŒ¯å…¥å¤±æ•—ï¼šJSON æ ¼å¼ä¸æ­£ç¢º"); } };
      r.readAsText(file); ev.target.value="";
    }

    function renderOrderTable(){
      const tbody=document.querySelector("#orderTable tbody");
      if(!tbody) return;
      const orders=readOrders(); tbody.innerHTML="";
      orders.forEach(o=>{
        const time=new Date(o.createdAt).toLocaleString();
        const selId=`sel_${o.id}`;
        tbody.innerHTML+=`
          <tr>
            <td>${o.id}</td>
            <td>${o.name} <span class="status-badge">${o.realName||"-"}</span></td>
            <td>${o.email}</td>
            <td>${o.type}</td>
            <td>${time}</td>
            <td>
              <select id="${selId}" onchange="updateOrderStatus('${o.id}', this.value)">
                ${["å¾…å¯©æ ¸","å·²æ¥å—","å·²æ‹’çµ•","å·²ä»˜æ¬¾","å·²å®Œæˆ"].map(s=>`<option ${o.status===s?'selected':''}>${s}</option>`).join("")}
              </select>
            </td>
            <td>
              <button class="btn outline" onclick="viewOrder('${o.id}')">ğŸ”</button>
              <button class="btn" onclick="resendOrder('${o.id}')">ğŸ“¤ é€šçŸ¥</button>
              <button class="btn delete" onclick="deleteOrder('${o.id}')">ğŸ—‘ï¸</button>
            </td>
          </tr>`;
      });
    }
    function updateOrderStatus(id,status){
      let list=readOrders(); const i=list.findIndex(o=>o.id===id); if(i===-1) return;
      list[i].status=status; writeOrders(list); alert(`è¨‚å–® ${id} ç‹€æ…‹å·²æ›´æ–°ç‚ºï¼š${status}`);
    }
    function deleteOrder(id){
      if(!confirm("ç¢ºå®šåˆªé™¤è¨‚å–® "+id+" ?")) return;
      writeOrders(readOrders().filter(o=>o.id!==id)); renderOrderTable();
    }
    function viewOrder(id){
      const o=readOrders().find(x=>x.id===id); if(!o) return alert("æ‰¾ä¸åˆ°è¨‚å–®");
      alert(`è¨‚å–®ç·¨è™Ÿï¼š${o.id}\nå®¢æˆ¶ï¼š${o.name}ï¼ˆ${o.email}ï¼‰\nçœŸå¯¦å§“åï¼š${o.realName}\né¡å‹ï¼š${o.type}\nç‹€æ…‹ï¼š${o.status}\nå»ºç«‹æ™‚é–“ï¼š${new Date(o.createdAt).toLocaleString()}\n\néœ€æ±‚ï¼š\n${o.desc}\n\nåˆç´„ï¼š\n${o.contract}`);
    }
    function resendOrder(id){
      const o=readOrders().find(x=>x.id===id); if(!o) return alert("æ‰¾ä¸åˆ°è¨‚å–®");
      notifyChannels(o); alert("å·²å˜—è©¦é‡æ–°é€šçŸ¥ï¼ˆDiscord / Emailï¼‰");
    }

    // å¡ç‰‡å‡ºå ´å‹•ç•«
    let cardObserver=null;
    function ensureObserver(){
      if(cardObserver) return cardObserver;
      cardObserver=new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            entry.target.classList.add("show");
            cardObserver.unobserve(entry.target);
          }
        });
      },{threshold:0.2}); return cardObserver;
    }
    function attachObserverToCards(root){
      if(!root) return;
      const obs=ensureObserver();
      root.querySelectorAll(".card").forEach(c=>{ if(!c.classList.contains("show")) obs.observe(c); });
    }

    // åˆå§‹åŒ–
    document.getElementById('year').textContent=new Date().getFullYear();
    renderAuthArea();
    renderWelcomeMsg();
    showSection((location.hash||'#home').slice(1));
    attachObserverToCards(document.getElementById('home'));
  </script>
</body>
</html>

